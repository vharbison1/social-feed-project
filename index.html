  
<!DOCTYPE html>
<html>
    <head>
        <title>Social Media Project</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="styles.css">
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://kit.fontawesome.com/e5bd83b59d.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <h1 class="text-center">FACE TWIT</h1>
        <div id="input-container">
            <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">Your Name</span>
                    </div>
                    <input type="text" id="name" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1" maxlength="30">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon2">Your Image URL</span>
                </div>
                <input type="text" id="input-file" class="form-control" placeholder="Your File URL must end in jpg, jpeg, png, or gif" aria-label="jpg, jpeg, png, or gif" aria-describedby="basic-addon2">
            </div>
            <div class="input-group">
                    <div class="input-group-prepend">
                    <span class="input-group-text">WRITE</span>
                    </div>
                    <textarea id="contents" class="form-control" aria-label="With textarea" maxlength="150"></textarea>
            </div>
            <div class="text-center formatpostbutton">
                <button type="submit" id="post" class="btn btn-success">POST</button>
            </div>
        </div>

        <div id="post-container" class="row"></div> <!-- For some reason class card-deck is not responsive -->

    </body>
    <script type="text/javascript">

    //Show All Post Stored in Express Server
    publish();

    var postContainer = document.getElementById('post-container'); //start of card-deck

    document.getElementById("post").onclick = function(event) 
    {   
        //If more than 0, validation throws an error. Post Wont Update
        var errorExist = 0;

        //Loops through data and sets the property values
        var inputs = document.querySelectorAll('input, textarea'); //looks for input or textarea
        var postData = {};

        inputs.forEach(function(item){
            
            errorExist = inputValidation(item.id,item.value,errorExist); //If error exist, Wont Post/Populate user info and alert.

            if(item.id == "name")
            {
                postData["username"] = item.value;
            }
            else if (item.id == "input-file")
            {
                postData["imageposted"] = item.value;
            }
            else if (item.id == "contents")
            {
                postData["postcontents"] = item.value;
            }
        });

        postData["dateposted"] = todaysDate(); //Sets Todays Date
        
        if(errorExist == 0)
        {
            //post then call publish to republish
            axios.post("http://localhost:3000/api/messages", postData).then(function(res)
            {
                return res;
            })
            .then(function(res)
            {
                publish();

                //Clear Input Data Once User Submits
                clearInputData(); 
            })
            .catch(function(error)
            {
                console.log(error);
            });
        }
    }



    //Calls the messages API with GET
    //Loops Through users data and populates separately in card data (bootstrap)
    function publish()
    {
        axios.get("http://localhost:3000/api/messages").then(function (res)
        {
            var columnContainerSize = '';
            console.log(res);

            if(res.data)
            {
                res.data.forEach(function(data)
                {
                    columnContainerSize += 
                    `<div class="col-sm-3" id=${data.id}>
                        <div class="card border border-white">
                            <div class="card-body">
                                ${data.img ? `<img src=${data.img} class="card-img-top" >` : ''} 
                                <p class="card-text">${data.content}</p>
                                <p class="card-text">
                                    <small class="text-muted">${data.username} created on ${data.dateposted}</small>
                                </p>
                                <div class="form-group">
                                    <label>Colors</label>
                                    <select class="form-control" onchange="changeColor(this) name="colorlist"></select>                                  
                                </div>
                                <button class="float-right btn btn-light delete-post" onclick="deletePost(this)">Delete</button>
                            </div>
                        </div>
                    </div>`;
                });
                //After Loop and concatenate each bootstrap post with contains, 
                postContainer.innerHTML = columnContainerSize;
            }
        });
    }

    function inputValidation(id,value,error)
    {
        //File Must be an image
        if(id == "input-file" && value != "")
        {
            var acceptedImageTypes  = ['jpg','jpeg','gif','png'];
            var extension = value.split('.').pop();
            if(acceptedImageTypes.indexOf(extension) == -1) { error += 1; alert("IMAGES ONLY!")}
        }
        //No Empty Strings can be posted
        //Skips Image
        else if(id != "input-file" && value == "")
        {
            error += 1;
            alert("NO EMPTY CHARACTERS!");
        }

        return error;
    }

    function todaysDate() 
    {
        var today = new Date();
        return (today.getMonth()+1) + "/" + today.getDate() + "/" + today.getFullYear();
    }

    //Grabs all current elements class delete-post and attach onclick element.    
    //item is reference to the current class the user is in
    function deletePost(item)
    {    
        var elements = item.parentNode.parentNode.parentNode; //Goes to card-body-> then card -> then looks at col-m3 div

        var data = {
            id : elements.id
        };

        axios.delete(`http://localhost:3000/api/messages/${elements.id}`).then(function (res)
        {
            publish();
        })
        .catch(function(error)
        {
            console.log(error);
        });
    }

    //Changes Color based off what user chooses
    function changeColor(item)
    {
        var backgroundColor = '';
        if(item.value == 'white')
        {
            backgroundColor = "#FFFFFF";
        }
        else if (item.value == "blue")
        {
            backgroundColor = "#86D3FF";
        }
        else 
        {
            backgroundColor = "#B2E6C0";
        }


        var elements = item.parentNode.parentNode; //Goes to card-body-> then card
        elements.style.background = backgroundColor;
    }

    //Populates colorlist options select field 
    function colorList(selectElement)
    {
        var colorsToAdd = ['white','blue','green'];
        for(var i = 0; i < colorsToAdd.length;i++)
        {
        var colorOptions = document.createElement("option");
        colorOptions.text = colorsToAdd[i];
        selectElement.appendChild(colorOptions);
        }
    }
    
    //Clear input data once user clicks post button
    function clearInputData()
    {
       document.getElementById('name').value = "";
       document.getElementById('input-file').value = "";
       document.getElementById('contents').value = "";
    }

    //TO DO COLOR LIST
    //TO DO UPDATE POST  
    </script>
</html>